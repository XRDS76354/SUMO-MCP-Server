# SUMO-MCP: æ™ºèƒ½äº¤é€šä»¿çœŸä¸æ§åˆ¶çš„ MCP å¹³å°

<div align="center">
  <img src="doc/sumo-mcp.jpg" alt="SUMO-MCP Logo" width="200" />
  <br />
  <br />
  <p align="center">
    <img src="https://img.shields.io/badge/Status-Active-success" alt="Status" />
    <img src="https://img.shields.io/badge/Python-3.10+-blue" alt="Python" />
    <img src="https://img.shields.io/badge/License-MIT-green" alt="License" />
  </p>
</div>

SUMO-MCP æ˜¯ä¸€ä¸ªè¿æ¥å¤§è¯­è¨€æ¨¡å‹ (LLM) ä¸ [Eclipse SUMO](https://www.eclipse.org/sumo/) äº¤é€šä»¿çœŸçš„ä¸­é—´ä»¶ã€‚é€šè¿‡ [Model Context Protocol (MCP)](https://modelcontextprotocol.io/)ï¼Œå®ƒå…è®¸ AI æ™ºèƒ½ä½“ï¼ˆå¦‚ Claude, Cursor, TRAEç­‰ï¼‰ç›´æ¥è°ƒç”¨ SUMO çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå®ç°ä»**OpenStreetMap æ•°æ®è·å–**ã€**è·¯ç½‘ç”Ÿæˆ**ã€**éœ€æ±‚å»ºæ¨¡**åˆ°**ä»¿çœŸè¿è¡Œ**ä¸**ä¿¡å·ä¼˜åŒ–**çš„å…¨æµç¨‹è‡ªåŠ¨åŒ–ã€‚

ç³»ç»Ÿæ”¯æŒ**ç¦»çº¿ä»¿çœŸ**ï¼ˆåŸºäºæ–‡ä»¶çš„å·¥ä½œæµï¼‰å’Œ**åœ¨çº¿äº¤äº’**ï¼ˆå®æ—¶ TraCI æ§åˆ¶ï¼‰ä¸¤ç§æ¨¡å¼ï¼Œæ»¡è¶³ä»å®è§‚è§„åˆ’åˆ°å¾®è§‚æ§åˆ¶çš„å¤šæ ·åŒ–éœ€æ±‚ã€‚

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

### 1. å…¨é¢çš„å·¥å…·é“¾é›†æˆ
èšåˆç¬¦åˆç›´è§‰çš„æ ¸å¿ƒ MCP æ¥å£ï¼Œç®€åŒ– SUMO å¤æ‚æ“ä½œï¼š

*   **è·¯ç½‘ç®¡ç† (`manage_network`)**: æ”¯æŒè·¯ç½‘ç”Ÿæˆ (`generate`)ã€OSM åœ°å›¾ä¸‹è½½ (`download_osm`) ä¸æ ¼å¼è½¬æ¢ (`convert`)ã€‚
*   **éœ€æ±‚ç®¡ç† (`manage_demand`)**: æä¾›éšæœºè¡Œç¨‹ç”Ÿæˆ (`generate_random`)ã€OD çŸ©é˜µè½¬æ¢ (`convert_od`) å’Œè·¯å¾„è®¡ç®— (`compute_routes`)ã€‚
*   **ä¿¡å·ä¼˜åŒ– (`optimize_traffic_signals`)**: é›†æˆå‘¨æœŸè‡ªé€‚åº” (`cycle_adaptation`) å’Œç»¿æ³¢åè°ƒ (`coordination`) ç®—æ³•ã€‚
*   **ä»¿çœŸä¸åˆ†æ**: æ”¯æŒæ ‡å‡†é…ç½®æ–‡ä»¶ä»¿çœŸ (`run_simple_simulation`) ä¸ FCD è½¨è¿¹æ•°æ®åˆ†æ (`run_analysis`)ã€‚

### 2. åœ¨çº¿å®æ—¶äº¤äº’ (Online Interaction)
æ”¯æŒé€šè¿‡ TraCI åè®®ä¸è¿è¡Œä¸­çš„ä»¿çœŸå®ä¾‹è¿›è¡Œå®æ—¶äº¤äº’ï¼Œèµ‹äºˆ LLM å¾®è§‚æ§åˆ¶ä¸æ„ŸçŸ¥èƒ½åŠ›ï¼š

*   **ä»¿çœŸæ§åˆ¶ (`control_simulation`)**: æä¾›å¯åŠ¨è¿æ¥ (`connect`)ã€å•æ­¥æ¨æ¼” (`step`) å’Œå®‰å…¨æ–­å¼€ (`disconnect`)ã€‚
*   **çŠ¶æ€æŸ¥è¯¢ (`query_simulation_state`)**: å®æ—¶è·å–è½¦è¾†åˆ—è¡¨ (`vehicle_list`)ã€è½¦è¾†ç»†èŠ‚å˜é‡ (`vehicle_variable`) åŠå…¨å±€ä»¿çœŸç»Ÿè®¡ã€‚

### 3. è‡ªåŠ¨åŒ–æ™ºèƒ½å·¥ä½œæµ
å†…ç½®ç«¯åˆ°ç«¯çš„è‡ªåŠ¨åŒ–å·¥ä½œæµ (`run_workflow`)ï¼Œç®€åŒ–å¤æ‚ç§‘ç ”ä¸å·¥ç¨‹ä»»åŠ¡ï¼š

*   **Sim Gen & Eval (`sim_gen_eval`)**: ä¸€é”®æ‰§è¡Œ "ç”Ÿæˆè·¯ç½‘ -> ç”Ÿæˆéœ€æ±‚ -> è·¯å¾„è®¡ç®— -> ä»¿çœŸè¿è¡Œ -> ç»“æœåˆ†æ" çš„å®Œæ•´é—­ç¯ã€‚
*   **Signal Optimization (`signal_opt`)**: è‡ªåŠ¨æ‰§è¡Œ "åŸºçº¿ä»¿çœŸ -> ä¿¡å·ä¼˜åŒ– -> ä¼˜åŒ–ä»¿çœŸ -> æ•ˆæœå¯¹æ¯”" çš„å…¨æµç¨‹ã€‚
*   **RL Training (`rl_train`)**: é’ˆå¯¹å†…ç½®åœºæ™¯æˆ–é€šè¿‡ `manage_rl_task` æ‰§è¡Œè‡ªå®šä¹‰è·¯ç½‘çš„å¼ºåŒ–å­¦ä¹ è®­ç»ƒã€‚

---

## ğŸ› ï¸ ç¯å¢ƒè¦æ±‚

*   **æ“ä½œç³»ç»Ÿ**: Windows / Linux / macOS
*   **Python**: 3.10+ (å¼ºåˆ¶è¦æ±‚ï¼Œä»¥æ”¯æŒæœ€æ–°çš„ç±»å‹ç³»ç»Ÿä¸ MCP SDK)
*   **SUMO**: [Eclipse SUMO](https://www.eclipse.org/sumo/)   (éœ€é…ç½® `SUMO_HOME` ç¯å¢ƒå˜é‡)

---

## ğŸ“¦ å®‰è£…æŒ‡å—

### 1. è·å–ä»£ç 

æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–é¡¹ç›®ï¼š

**æ–¹å¼ Aï¼šé€šè¿‡ Git å…‹éš† (æ¨è)**
```bash
git clone https://github.com/XRDS76354/sumo-mcp.git
cd sumo-mcp
```

**æ–¹å¼ Bï¼šä¸‹è½½å‹ç¼©åŒ…**
1. è®¿é—® [GitHub é¡¹ç›®ä¸»é¡µ](https://github.com/XRDS76354/sumo-mcp)ã€‚
2. ç‚¹å‡» **Code** æŒ‰é’®ï¼Œé€‰æ‹© **Download ZIP**ã€‚
3. è§£å‹å¹¶è¿›å…¥é¡¹ç›®ç›®å½•ã€‚

**æ–¹å¼ Cï¼šä½œä¸ºä¾èµ–å®‰è£… (WIP)**
å¦‚æœæ‚¨æƒ³åœ¨å…¶ä»–é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œå¯ä»¥å°è¯•ï¼š
```bash
pip install git+https://github.com/XRDS76354/sumo-mcp.git
```

## ğŸ› ï¸ ç¯å¢ƒé…ç½® (äºŒé€‰ä¸€)

æ‚¨å¯ä»¥é€‰æ‹©ä»¥ä¸‹ä»»ä¸€æ–¹å¼é…ç½®å¼€å‘ç¯å¢ƒã€‚

### é€‰é¡¹ Aï¼šä½¿ç”¨ uv (æ¨è - æé€Ÿ)

[uv](https://github.com/astral-sh/uv) æ˜¯ç›®å‰æœ€å¿«çš„ Python åŒ…ç®¡ç†å·¥å…·ï¼Œæ”¯æŒä¸€é”®åŒæ­¥ä¾èµ–ã€‚

```bash
# 1. å®‰è£… uv (å¦‚æœå°šæœªå®‰è£…)
pip install uv

# 2. åŒæ­¥é¡¹ç›®ç¯å¢ƒ (è‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–)
uv sync

# 3. æ¿€æ´»ç¯å¢ƒ
# Windows:
.venv\Scripts\activate
# Linux/macOS:
source .venv/bin/activate
```

### é€‰é¡¹ Bï¼šä½¿ç”¨ Conda + Pip (ä¼ ç»Ÿ)

å¦‚æœæ‚¨ä¹ æƒ¯ä½¿ç”¨ Conda ç®¡ç†ç¯å¢ƒï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

```bash
# 1. åˆ›å»ºå¹¶æ¿€æ´» Conda ç¯å¢ƒ
conda create -n sumo-mcp python=3.10 -y
conda activate sumo-mcp

# 2. å®‰è£…é¡¹ç›®ä¾èµ– (åŒ…å«å¼€å‘å·¥å…·)
pip install -e ".[dev]"
```

### 4. é…ç½® SUMO
ç¡®ä¿ç³»ç»Ÿç¯å¢ƒå˜é‡ `SUMO_HOME` æŒ‡å‘æ‚¨çš„ SUMO å®‰è£…ç›®å½• (ä¾‹å¦‚ `F:\sumo`)ã€‚

---

## ğŸš¦ å¯åŠ¨æœåŠ¡

ä½¿ç”¨ Python å¯åŠ¨ MCP æœåŠ¡å™¨ï¼š

```bash
python src/server.py
```

æœåŠ¡å™¨å¯åŠ¨åå°†ç›‘å¬æ ‡å‡†è¾“å…¥ (stdin) çš„ JSON-RPC æ¶ˆæ¯ï¼Œæ‚¨å¯ä»¥å°†å…¶é…ç½®åˆ°ä»»ä½•æ”¯æŒ MCP çš„å®¿ä¸»åº”ç”¨ä¸­ã€‚

**Claude Desktop é…ç½®ç¤ºä¾‹**:

```json
{
  "mcpServers": {
    "sumo-mcp": {
      "command": "path/to/your/venv/python",
      "args": ["path/to/sumo-mcp/src/server.py"]
    }
  }
}
```

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹ (Prompt)

åœ¨é…ç½®äº† MCP çš„ AI åŠ©æ‰‹ä¸­ï¼Œæ‚¨å¯ä»¥å°è¯•ä»¥ä¸‹è‡ªç„¶è¯­è¨€æŒ‡ä»¤ï¼š

*   **å·¥ä½œæµä»»åŠ¡**:
    > "ç”Ÿæˆä¸€ä¸ª 3x3 çš„ç½‘æ ¼è·¯ç½‘ï¼Œæ¨¡æ‹Ÿ 1000 ç§’çš„äº¤é€šæµï¼Œå¹¶å‘Šè¯‰æˆ‘å¹³å‡è½¦é€Ÿã€‚"
    > *(AI å°†è°ƒç”¨ `manage_network` å’Œ `run_workflow`)*
*   **åœ¨çº¿äº¤äº’ä»»åŠ¡**:
    > "å¯åŠ¨è¿™ä¸ªé…ç½®æ–‡ä»¶çš„ä»¿çœŸï¼Œæ¯è¿è¡Œä¸€æ­¥å°±å‘Šè¯‰æˆ‘ ID ä¸º 'v_0' çš„è½¦è¾†é€Ÿåº¦ï¼Œå¦‚æœé€Ÿåº¦ä½äº 5m/s å°±æé†’æˆ‘ã€‚"
    > *(AI å°†è°ƒç”¨ `control_simulation` å’Œ `query_simulation_state`)*
*   **å¼ºåŒ–å­¦ä¹ ä»»åŠ¡**:
    > "åˆ—å‡ºæ‰€æœ‰å†…ç½®çš„å¼ºåŒ–å­¦ä¹ åœºæ™¯ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªç®€å•çš„è·¯å£åœºæ™¯è®­ç»ƒ 5 ä¸ªå›åˆã€‚"
    > *(AI å°†è°ƒç”¨ `manage_rl_task` å’Œ `run_workflow`)*

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```text
sumo-mcp/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ server.py           # MCP æœåŠ¡å™¨å…¥å£ (LiteMCP å®ç°ï¼Œèšåˆæ¥å£)
â”‚   â”œâ”€â”€ utils/              # é€šç”¨å·¥å…·
â”‚   â”‚   â”œâ”€â”€ connection.py   # TraCI è¿æ¥ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ mcp_tools/          # æ ¸å¿ƒå·¥å…·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ network.py      # ç½‘ç»œå·¥å…·
â”‚   â”‚   â”œâ”€â”€ route.py        # è·¯å¾„å·¥å…·
â”‚   â”‚   â”œâ”€â”€ signal.py       # ä¿¡å·å·¥å…·
â”‚   â”‚   â”œâ”€â”€ vehicle.py      # è½¦è¾†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ rl.py           # å¼ºåŒ–å­¦ä¹ å·¥å…·
â”‚   â”‚   â””â”€â”€ analysis.py     # åˆ†æå·¥å…·
â”‚   â””â”€â”€ workflows/          # è‡ªåŠ¨åŒ–å·¥ä½œæµ
â”‚       â”œâ”€â”€ sim_gen.py      # ä»¿çœŸç”Ÿæˆå·¥ä½œæµ
â”‚       â”œâ”€â”€ signal_opt.py   # ä¿¡å·ä¼˜åŒ–å·¥ä½œæµ
â”‚       â””â”€â”€ rl_train.py     # RL è®­ç»ƒå·¥ä½œæµ
â”œâ”€â”€ pyproject.toml          # é¡¹ç›®é…ç½®ä¸ä¾èµ–ç®¡ç†
â”œâ”€â”€ requirements.lock       # é”å®šä¾èµ–ç‰ˆæœ¬
â””â”€â”€ README.md               # é¡¹ç›®æ–‡æ¡£
```

## ğŸ“„ è®¸å¯è¯

MIT License
